<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cheesecake: D:/Projects/Raspberrypi_pico/pico_freertos_final/freertos_pico2/pico_freertos/FreeRTOS-Kernel/portable/GCC/TriCore_1782/port.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">cheesecake
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('_g_c_c_2_tri_core__1782_2port_8c_source.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">port.c</div></div>
</div><!--header-->
<div class="contents">
<a href="_g_c_c_2_tri_core__1782_2port_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment"> * FreeRTOS Kernel &lt;DEVELOPMENT BRANCH&gt;</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"> * Copyright (C) 2021 Amazon.com, Inc. or its affiliates. All Rights Reserved.</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment"> *</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"> * SPDX-License-Identifier: MIT</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment"> *</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment"> * Permission is hereby granted, free of charge, to any person obtaining a copy of</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment"> * this software and associated documentation files (the &quot;Software&quot;), to deal in</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment"> * the Software without restriction, including without limitation the rights to</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment"> * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment"> * the Software, and to permit persons to whom the Software is furnished to do so,</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment"> * subject to the following conditions:</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment"> *</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment"> * The above copyright notice and this permission notice shall be included in all</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment"> * copies or substantial portions of the Software.</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment"> *</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="comment"> * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="comment"> * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="comment"> * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="comment"> * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="comment"> *</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="comment"> * https://www.FreeRTOS.org</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="comment"> * https://github.com/FreeRTOS</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="comment"> *</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="comment"> */</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span> </div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="comment">/* Standard includes. */</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span> </div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="comment">/* TriCore specific includes. */</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="preprocessor">#include &lt;tc1782.h&gt;</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="preprocessor">#include &lt;machine/intrinsics.h&gt;</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="preprocessor">#include &lt;machine/cint.h&gt;</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="preprocessor">#include &lt;machine/wdtcon.h&gt;</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span> </div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="comment">/* Kernel includes. */</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="preprocessor">#include &quot;<a class="code" href="_free_r_t_o_s_8h.html">FreeRTOS.h</a>&quot;</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="preprocessor">#include &quot;<a class="code" href="task_8h.html">task.h</a>&quot;</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="preprocessor">#include &quot;<a class="code" href="list_8h.html">list.h</a>&quot;</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span> </div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="preprocessor">#if configCHECK_FOR_STACK_OVERFLOW &gt; 0</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="preprocessor">    #error &quot;Stack checking cannot be used with this port, as, unlike most ports, the pxTopOfStack member of the TCB is consumed CSA.  CSA starvation, loosely equivalent to stack overflow, will result in a trap exception.&quot;</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>    <span class="comment">/* The stack pointer is accessible using portCSA_TO_ADDRESS( portCSA_TO_ADDRESS( pxCurrentTCB-&gt;pxTopOfStack )[ 0 ] )[ 2 ]; */</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="preprocessor">#endif </span><span class="comment">/* configCHECK_FOR_STACK_OVERFLOW */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span> </div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span> </div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="comment">/*-----------------------------------------------------------*/</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span> </div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span><span class="comment">/* System register Definitions. */</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno"><a class="line" href="_g_c_c_2_tri_core__1782_2port_8c.html#a53c7e0018d578cc75a6de242b255efe7">   53</a></span><span class="preprocessor">#define portSYSTEM_PROGRAM_STATUS_WORD                  ( 0x000008FFUL ) </span><span class="comment">/* Supervisor Mode, MPU Register Set 0 and Call Depth Counting disabled. */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno"><a class="line" href="_g_c_c_2_tri_core__1782_2port_8c.html#aebaaca5ba9d52f6f5bf4710cf2e85cd5">   54</a></span><span class="preprocessor">#define portINITIAL_PRIVILEGED_PROGRAM_STATUS_WORD      ( 0x000014FFUL ) </span><span class="comment">/* IO Level 1, MPU Register Set 1 and Call Depth Counting disabled. */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno"><a class="line" href="_g_c_c_2_tri_core__1782_2port_8c.html#a03c1ebce1ade45e402edb73ceb8379aa">   55</a></span><span class="preprocessor">#define portINITIAL_UNPRIVILEGED_PROGRAM_STATUS_WORD    ( 0x000010FFUL ) </span><span class="comment">/* IO Level 0, MPU Register Set 1 and Call Depth Counting disabled. */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno"><a class="line" href="_g_c_c_2_tri_core__1782_2port_8c.html#a04fc64e05f3949f4ff4b5c276c036407">   56</a></span><span class="preprocessor">#define portINITIAL_PCXI_UPPER_CONTEXT_WORD             ( 0x00C00000UL ) </span><span class="comment">/* The lower 20 bits identify the CSA address. */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno"><a class="line" href="_g_c_c_2_tri_core__1782_2port_8c.html#ad00855b9a1ed5b492cea473aa43574af">   57</a></span><span class="preprocessor">#define portINITIAL_SYSCON                              ( 0x00000000UL ) </span><span class="comment">/* MPU Disable. */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span> </div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span><span class="comment">/* CSA manipulation macros. */</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno"><a class="line" href="_g_c_c_2_tri_core__1782_2port_8c.html#a24b47f41a4ccf1c96020b4981fec5f98">   60</a></span><span class="preprocessor">#define portCSA_FCX_MASK                                ( 0x000FFFFFUL )</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span> </div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span><span class="comment">/* OS Interrupt and Trap mechanisms. */</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno"><a class="line" href="_g_c_c_2_tri_core__1782_2port_8c.html#a8b8c4b80063cf1c2f6da57b93b66d595">   63</a></span><span class="preprocessor">#define portRESTORE_PSW_MASK                            ( ~( 0x000000FFUL ) )</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno"><a class="line" href="_g_c_c_2_tri_core__1782_2port_8c.html#af46f8ef7814652af16a16ef746a6fe56">   64</a></span><span class="preprocessor">#define portSYSCALL_TRAP                                ( 6 )</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span> </div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span><span class="comment">/* Each CSA contains 16 words of data. */</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno"><a class="line" href="_g_c_c_2_tri_core__1782_2port_8c.html#ad3bc25f78b2c1da77824c18234353c71">   67</a></span><span class="preprocessor">#define portNUM_WORDS_IN_CSA                            ( 16 )</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span> </div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span><span class="comment">/* The interrupt enable bit in the PCP_SRC register. */</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno"><a class="line" href="_g_c_c_2_tri_core__1782_2port_8c.html#a1191455c4b11064d65717fc18324faac">   70</a></span><span class="preprocessor">#define portENABLE_CPU_INTERRUPT                        ( 1U &lt;&lt; 12U )</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span><span class="comment">/*-----------------------------------------------------------*/</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span> </div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span><span class="comment">/*</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span><span class="comment"> * Perform any hardware configuration necessary to generate the tick interrupt.</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span><span class="comment"> */</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span><span class="keyword">static</span> <span class="keywordtype">void</span> prvSystemTickHandler( <span class="keywordtype">int</span> ) <a class="code hl_function" href="_g_c_c_2_a_r_m___a_a_r_c_h64_2port_8c.html#ab35b2424ac8c0625cfdbbcf916c5e1c3">__attribute__</a>( ( longcall ) );</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="_rowley_2_m_s_p430_f449_2port_8c.html#a397ed34de04a678dc71217c713763423">prvSetupTimerInterrupt</a>( <span class="keywordtype">void</span> );</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span> </div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span><span class="comment">/*</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span><span class="comment"> * Trap handler for yields.</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span><span class="comment"> */</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span><span class="keyword">static</span> <span class="keywordtype">void</span> prvTrapYield( <span class="keywordtype">int</span> iTrapIdentification );</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span> </div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span><span class="comment">/*</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span><span class="comment"> * Priority 1 interrupt handler for yields pended from an interrupt.</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span><span class="comment"> */</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span><span class="keyword">static</span> <span class="keywordtype">void</span> prvInterruptYield( <span class="keywordtype">int</span> iTrapIdentification );</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span> </div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span><span class="comment">/*-----------------------------------------------------------*/</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span> </div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span><span class="comment">/* This reference is required by the save/restore context macros. */</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span><span class="keyword">extern</span> <span class="keyword">volatile</span> uint32_t * <a class="code hl_define" href="tasks_8c.html#aeceb1ce641f0a4c4a5a298b1f3cbae9e">pxCurrentTCB</a>;</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span> </div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span><span class="comment">/* Precalculate the compare match value at compile time. */</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span><span class="keyword">static</span> <span class="keyword">const</span> uint32_t ulCompareMatchValue = ( configPERIPHERAL_CLOCK_HZ / <a class="code hl_define" href="_free_r_t_o_s-_kernel_2examples_2coverity_2_free_r_t_o_s_config_8h.html#a2f0258dd1e3b877e5bc013be54c2db6a">configTICK_RATE_HZ</a> );</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span> </div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span><span class="comment">/*-----------------------------------------------------------*/</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span> </div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span><a class="code hl_typedef" href="_a_r_mv8_m_2non__secure_2portmacrocommon_8h.html#a84e9a8ba132feed0b2401c1f4e2ac63c">StackType_t</a> * <a class="code hl_function" href="_a_r_mv8_m_2non__secure_2port_8c.html#aaa2085423d917cf1707f4770de3354e2">pxPortInitialiseStack</a>( <a class="code hl_typedef" href="_a_r_mv8_m_2non__secure_2portmacrocommon_8h.html#a84e9a8ba132feed0b2401c1f4e2ac63c">StackType_t</a> * pxTopOfStack,</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>                                     <a class="code hl_typedef" href="projdefs_8h.html#a0ab243e55144f5278d263729530dac14">TaskFunction_t</a> pxCode,</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>                                     <span class="keywordtype">void</span> * pvParameters )</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>{</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    uint32_t * pulUpperCSA = <a class="code hl_define" href="_third_party_2_g_c_c_2_a_r_c___e_m___h_s_2portmacro_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>    uint32_t * pulLowerCSA = <a class="code hl_define" href="_third_party_2_g_c_c_2_a_r_c___e_m___h_s_2portmacro_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span> </div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>    <span class="comment">/* 16 Address Registers (4 Address registers are global), 16 Data</span></div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span><span class="comment">     * Registers, and 3 System Registers.</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span><span class="comment">     *</span></div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span><span class="comment">     * There are 3 registers that track the CSAs.</span></div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span><span class="comment">     *  FCX points to the head of globally free set of CSAs.</span></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span><span class="comment">     *  PCX for the task needs to point to Lower-&gt;Upper-&gt;NULL arrangement.</span></div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span><span class="comment">     *  LCX points to the last free CSA so that corrective action can be taken.</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span><span class="comment">     *</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span><span class="comment">     * Need two CSAs to store the context of a task.</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span><span class="comment">     *  The upper context contains D8-D15, A10-A15, PSW and PCXI-&gt;NULL.</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span><span class="comment">     *  The lower context contains D0-D7, A2-A7, A11 and PCXI-&gt;UpperContext.</span></div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span><span class="comment">     *  The pxCurrentTCB-&gt;pxTopOfStack points to the Lower Context RSLCX matching the initial BISR.</span></div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span><span class="comment">     *  The Lower Context points to the Upper Context ready for the return from the interrupt handler.</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span><span class="comment">     *</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span><span class="comment">     * The Real stack pointer for the task is stored in the A10 which is restored</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span><span class="comment">     * with the upper context. */</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span> </div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>    <span class="comment">/* Have to disable interrupts here because the CSAs are going to be</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span><span class="comment">     * manipulated. */</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    <a class="code hl_define" href="_a_r_mv8_m_2non__secure_2portmacrocommon_8h.html#a8a09321ad004019f3c8d0f2e4d7224c7">portENTER_CRITICAL</a>();</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    {</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>        <span class="comment">/* DSync to ensure that buffering is not a problem. */</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>        _dsync();</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span> </div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>        <span class="comment">/* Consume two free CSAs. */</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>        pulLowerCSA = <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2portmacro_8h.html#a7bfbb11e7993c09f2c131e50b65edbff">portCSA_TO_ADDRESS</a>( __MFCR( $FCX ) );</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span> </div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>        <span class="keywordflow">if</span>( <a class="code hl_define" href="_third_party_2_g_c_c_2_a_r_c___e_m___h_s_2portmacro_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> != pulLowerCSA )</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>        {</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>            <span class="comment">/* The Lower Links to the Upper. */</span></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>            pulUpperCSA = <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2portmacro_8h.html#a7bfbb11e7993c09f2c131e50b65edbff">portCSA_TO_ADDRESS</a>( pulLowerCSA[ 0 ] );</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>        }</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span> </div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>        <span class="comment">/* Check that we have successfully reserved two CSAs. */</span></div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>        <span class="keywordflow">if</span>( ( <a class="code hl_define" href="_third_party_2_g_c_c_2_a_r_c___e_m___h_s_2portmacro_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> != pulLowerCSA ) &amp;&amp; ( <a class="code hl_define" href="_third_party_2_g_c_c_2_a_r_c___e_m___h_s_2portmacro_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> != pulUpperCSA ) )</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>        {</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>            <span class="comment">/* Remove the two consumed CSAs from the free CSA list. */</span></div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>            _disable();</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>            _dsync();</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>            _mtcr( $FCX, pulUpperCSA[ 0 ] );</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>            _isync();</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>            _enable();</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>        }</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>        {</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>            <span class="comment">/* Simply trigger a context list depletion trap. */</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>            _svlcx();</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>        }</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    }</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    <a class="code hl_define" href="_a_r_mv8_m_2non__secure_2portmacrocommon_8h.html#a529358e6147881dd881c890ade21c9bd">portEXIT_CRITICAL</a>();</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span> </div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    <span class="comment">/* Clear the upper CSA. */</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    memset( pulUpperCSA, 0, <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2port_8c.html#ad3bc25f78b2c1da77824c18234353c71">portNUM_WORDS_IN_CSA</a> * <span class="keyword">sizeof</span>( uint32_t ) );</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span> </div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    <span class="comment">/* Upper Context. */</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    pulUpperCSA[ 2 ] = ( uint32_t ) pxTopOfStack;      <span class="comment">/* A10; Stack Return aka Stack Pointer */</span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>    pulUpperCSA[ 1 ] = <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2port_8c.html#a53c7e0018d578cc75a6de242b255efe7">portSYSTEM_PROGRAM_STATUS_WORD</a>; <span class="comment">/* PSW  */</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span> </div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>    <span class="comment">/* Clear the lower CSA. */</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    memset( pulLowerCSA, 0, <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2port_8c.html#ad3bc25f78b2c1da77824c18234353c71">portNUM_WORDS_IN_CSA</a> * <span class="keyword">sizeof</span>( uint32_t ) );</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span> </div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    <span class="comment">/* Lower Context. */</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    pulLowerCSA[ 8 ] = ( uint32_t ) pvParameters; <span class="comment">/* A4;  Address Type Parameter Register */</span></div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    pulLowerCSA[ 1 ] = ( uint32_t ) pxCode;       <span class="comment">/* A11; Return Address aka RA */</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span> </div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    <span class="comment">/* PCXI pointing to the Upper context. */</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>    pulLowerCSA[ 0 ] = ( <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2port_8c.html#a04fc64e05f3949f4ff4b5c276c036407">portINITIAL_PCXI_UPPER_CONTEXT_WORD</a> | ( uint32_t ) <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2portmacro_8h.html#a625b0cc597364c07a6fa0f13f7c83374">portADDRESS_TO_CSA</a>( pulUpperCSA ) );</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span> </div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>    <span class="comment">/* Save the link to the CSA in the top of stack. */</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>    pxTopOfStack = ( uint32_t * ) <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2portmacro_8h.html#a625b0cc597364c07a6fa0f13f7c83374">portADDRESS_TO_CSA</a>( pulLowerCSA );</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span> </div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    <span class="comment">/* DSync to ensure that buffering is not a problem. */</span></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>    _dsync();</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span> </div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>    <span class="keywordflow">return</span> pxTopOfStack;</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>}</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span><span class="comment">/*-----------------------------------------------------------*/</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span> </div>
<div class="foldopen" id="foldopen00184" data-start="{" data-end="}">
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno"><a class="line" href="_g_c_c_2_tri_core__1782_2port_8c.html#a42d48e1e07c99c055d4353dc3b38b466">  184</a></span>int32_t <a class="code hl_function" href="_a_r_mv8_m_2non__secure_2port_8c.html#ade5a8c6666e7413a0355cc252029c5c6">xPortStartScheduler</a>( <span class="keywordtype">void</span> )</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>{</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>    <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code hl_function" href="porttrap_8c.html#abb81dc2f729d6c6fe39b23aa9f61e1a5">vTrapInstallHandlers</a>( <span class="keywordtype">void</span> );</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>    uint32_t ulMFCR = 0UL;</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>    uint32_t * pulUpperCSA = <a class="code hl_define" href="_third_party_2_g_c_c_2_a_r_c___e_m___h_s_2portmacro_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>    uint32_t * pulLowerCSA = <a class="code hl_define" href="_third_party_2_g_c_c_2_a_r_c___e_m___h_s_2portmacro_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span> </div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>    <span class="comment">/* Interrupts at or below configMAX_SYSCALL_INTERRUPT_PRIORITY are disable</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span><span class="comment">     * when this function is called. */</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span> </div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>    <span class="comment">/* Set-up the timer interrupt. */</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>    <a class="code hl_function" href="_rowley_2_m_s_p430_f449_2port_8c.html#a397ed34de04a678dc71217c713763423">prvSetupTimerInterrupt</a>();</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span> </div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    <span class="comment">/* Install the Trap Handlers. */</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>    <a class="code hl_function" href="porttrap_8c.html#abb81dc2f729d6c6fe39b23aa9f61e1a5">vTrapInstallHandlers</a>();</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span> </div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>    <span class="comment">/* Install the Syscall Handler for yield calls. */</span></div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    <span class="keywordflow">if</span>( 0 == _install_trap_handler( <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2port_8c.html#af46f8ef7814652af16a16ef746a6fe56">portSYSCALL_TRAP</a>, prvTrapYield ) )</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>    {</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>        <span class="comment">/* Failed to install the yield handler, force an assert. */</span></div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>        <a class="code hl_define" href="_free_r_t_o_s-_kernel_2examples_2template__configuration_2_free_r_t_o_s_config_8h.html#a228c70cd48927d6ab730ed1a6dfbe35f">configASSERT</a>( ( ( <span class="keyword">volatile</span> <span class="keywordtype">void</span> * ) <a class="code hl_define" href="_third_party_2_g_c_c_2_a_r_c___e_m___h_s_2portmacro_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ) );</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    }</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span> </div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    <span class="comment">/* Enable then install the priority 1 interrupt for pending context</span></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span><span class="comment">     * switches from an ISR.  See mod_SRC in the TriCore manual. */</span></div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    CPU_SRC0.reg = ( <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2port_8c.html#a1191455c4b11064d65717fc18324faac">portENABLE_CPU_INTERRUPT</a> ) | ( configKERNEL_YIELD_PRIORITY );</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span> </div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>    <span class="keywordflow">if</span>( 0 == _install_int_handler( configKERNEL_YIELD_PRIORITY, prvInterruptYield, 0 ) )</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    {</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>        <span class="comment">/* Failed to install the yield handler, force an assert. */</span></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>        <a class="code hl_define" href="_free_r_t_o_s-_kernel_2examples_2template__configuration_2_free_r_t_o_s_config_8h.html#a228c70cd48927d6ab730ed1a6dfbe35f">configASSERT</a>( ( ( <span class="keyword">volatile</span> <span class="keywordtype">void</span> * ) <a class="code hl_define" href="_third_party_2_g_c_c_2_a_r_c___e_m___h_s_2portmacro_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ) );</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>    }</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span> </div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>    _disable();</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span> </div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    <span class="comment">/* Load the initial SYSCON. */</span></div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    _mtcr( $SYSCON, <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2port_8c.html#ad00855b9a1ed5b492cea473aa43574af">portINITIAL_SYSCON</a> );</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    _isync();</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span> </div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    <span class="comment">/* ENDINIT has already been applied in the &#39;cstart.c&#39; code. */</span></div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span> </div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>    <span class="comment">/* Clear the PSW.CDC to enable the use of an RFE without it generating an</span></div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span><span class="comment">     * exception because this code is not genuinely in an exception. */</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>    ulMFCR = __MFCR( $PSW );</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>    ulMFCR &amp;= <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2port_8c.html#a8b8c4b80063cf1c2f6da57b93b66d595">portRESTORE_PSW_MASK</a>;</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>    _dsync();</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>    _mtcr( $PSW, ulMFCR );</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>    _isync();</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span> </div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>    <span class="comment">/* Finally, perform the equivalent of a portRESTORE_CONTEXT() */</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>    pulLowerCSA = <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2portmacro_8h.html#a7bfbb11e7993c09f2c131e50b65edbff">portCSA_TO_ADDRESS</a>( ( *<a class="code hl_define" href="tasks_8c.html#aeceb1ce641f0a4c4a5a298b1f3cbae9e">pxCurrentTCB</a> ) );</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>    pulUpperCSA = <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2portmacro_8h.html#a7bfbb11e7993c09f2c131e50b65edbff">portCSA_TO_ADDRESS</a>( pulLowerCSA[ 0 ] );</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>    _dsync();</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>    _mtcr( $PCXI, *<a class="code hl_define" href="tasks_8c.html#aeceb1ce641f0a4c4a5a298b1f3cbae9e">pxCurrentTCB</a> );</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>    _isync();</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>    _nop();</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>    _rslcx();</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    _nop();</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span> </div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    <span class="comment">/* Return to the first task selected to execute. */</span></div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>    __asm <span class="keyword">volatile</span> ( <span class="stringliteral">&quot;rfe&quot;</span> );</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span> </div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>    <span class="comment">/* Will not get here. */</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>}</div>
</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span><span class="comment">/*-----------------------------------------------------------*/</span></div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span> </div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="_rowley_2_m_s_p430_f449_2port_8c.html#a397ed34de04a678dc71217c713763423">prvSetupTimerInterrupt</a>( <span class="keywordtype">void</span> )</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>{</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>    <span class="comment">/* Set-up the clock divider. */</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>    unlock_wdtcon();</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>    {</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>        <span class="comment">/* Wait until access to Endint protected register is enabled. */</span></div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>        <span class="keywordflow">while</span>( 0 != ( WDT_CON0.reg &amp; 0x1UL ) )</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>        {</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>        }</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span> </div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>        <span class="comment">/* RMC == 1 so STM Clock == FPI */</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>        STM_CLC.reg = ( 1UL &lt;&lt; 8 );</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>    }</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>    lock_wdtcon();</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span> </div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>    <span class="comment">/* Determine how many bits are used without changing other bits in the CMCON register. */</span></div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    STM_CMCON.reg &amp;= ~( 0x1fUL );</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>    STM_CMCON.reg |= ( 0x1fUL - __CLZ( configPERIPHERAL_CLOCK_HZ / <a class="code hl_define" href="_free_r_t_o_s-_kernel_2examples_2coverity_2_free_r_t_o_s_config_8h.html#a2f0258dd1e3b877e5bc013be54c2db6a">configTICK_RATE_HZ</a> ) );</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span> </div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>    <span class="comment">/* Take into account the current time so a tick doesn&#39;t happen immediately. */</span></div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>    STM_CMP0.reg = ulCompareMatchValue + STM_TIM0.reg;</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span> </div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>    <span class="keywordflow">if</span>( 0 != _install_int_handler( <a class="code hl_define" href="_free_r_t_o_s-_kernel_2examples_2coverity_2_free_r_t_o_s_config_8h.html#ac42cff506ad61d4174fa23e952e3225e">configKERNEL_INTERRUPT_PRIORITY</a>, prvSystemTickHandler, 0 ) )</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>    {</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>        <span class="comment">/* Set-up the interrupt. */</span></div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>        STM_SRC0.reg = ( <a class="code hl_define" href="_free_r_t_o_s-_kernel_2examples_2coverity_2_free_r_t_o_s_config_8h.html#ac42cff506ad61d4174fa23e952e3225e">configKERNEL_INTERRUPT_PRIORITY</a> | 0x00005000UL );</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span> </div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>        <span class="comment">/* Enable the Interrupt. */</span></div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>        STM_ISRR.reg &amp;= ~( 0x03UL );</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>        STM_ISRR.reg |= 0x1UL;</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>        STM_ISRR.reg &amp;= ~( 0x07UL );</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>        STM_ICR.reg |= 0x1UL;</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>    }</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>    {</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>        <span class="comment">/* Failed to install the Tick Interrupt. */</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>        <a class="code hl_define" href="_free_r_t_o_s-_kernel_2examples_2template__configuration_2_free_r_t_o_s_config_8h.html#a228c70cd48927d6ab730ed1a6dfbe35f">configASSERT</a>( ( ( <span class="keyword">volatile</span> <span class="keywordtype">void</span> * ) <a class="code hl_define" href="_third_party_2_g_c_c_2_a_r_c___e_m___h_s_2portmacro_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ) );</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>    }</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>}</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span><span class="comment">/*-----------------------------------------------------------*/</span></div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span> </div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span><span class="keyword">static</span> <span class="keywordtype">void</span> prvSystemTickHandler( <span class="keywordtype">int</span> iArg )</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>{</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>    uint32_t ulSavedInterruptMask;</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    uint32_t * pxUpperCSA = <a class="code hl_define" href="_third_party_2_g_c_c_2_a_r_c___e_m___h_s_2portmacro_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>    uint32_t xUpperCSA = 0UL;</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>    <span class="keyword">extern</span> <span class="keyword">volatile</span> uint32_t * <a class="code hl_define" href="tasks_8c.html#aeceb1ce641f0a4c4a5a298b1f3cbae9e">pxCurrentTCB</a>;</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>    int32_t lYieldRequired;</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span> </div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>    <span class="comment">/* Just to avoid compiler warnings about unused parameters. */</span></div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>    ( void ) iArg;</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span> </div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>    <span class="comment">/* Clear the interrupt source. */</span></div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>    STM_ISRR.reg = 1UL;</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span> </div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>    <span class="comment">/* Reload the Compare Match register for X ticks into the future.</span></div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span><span class="comment">     *</span></div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span><span class="comment">     * If critical section or interrupt nesting budgets are exceeded, then</span></div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span><span class="comment">     * it is possible that the calculated next compare match value is in the</span></div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span><span class="comment">     * past.  If this occurs (unlikely), it is possible that the resulting</span></div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span><span class="comment">     * time slippage will exceed a single tick period.  Any adverse effect of</span></div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span><span class="comment">     * this is time bounded by the fact that only the first n bits of the 56 bit</span></div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span><span class="comment">     * STM timer are being used for a compare match, so another compare match</span></div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span><span class="comment">     * will occur after an overflow in just those n bits (not the entire 56 bits).</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span><span class="comment">     * As an example, if the peripheral clock is 75MHz, and the tick rate is 1KHz,</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span><span class="comment">     * a missed tick could result in the next tick interrupt occurring within a</span></div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span><span class="comment">     * time that is 1.7 times the desired period.  The fact that this is greater</span></div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span><span class="comment">     * than a single tick period is an effect of using a timer that cannot be</span></div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span><span class="comment">     * automatically reset, in hardware, by the occurrence of a tick interrupt.</span></div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span><span class="comment">     * Changing the tick source to a timer that has an automatic reset on compare</span></div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span><span class="comment">     * match (such as a GPTA timer) will reduce the maximum possible additional</span></div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span><span class="comment">     * period to exactly 1 times the desired period. */</span></div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>    STM_CMP0.reg += ulCompareMatchValue;</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span> </div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    <span class="comment">/* Kernel API calls require Critical Sections. */</span></div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>    ulSavedInterruptMask = <a class="code hl_define" href="_free_r_t_o_s_8h.html#a31b4260dbc1823ba80b578f86eb15a98">portSET_INTERRUPT_MASK_FROM_ISR</a>();</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>    {</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>        <span class="comment">/* Increment the Tick. */</span></div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>        lYieldRequired = <a class="code hl_function" href="task_8h.html#a978e25460ac35706f9ad30b46d9403d8">xTaskIncrementTick</a>();</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>    }</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>    <a class="code hl_define" href="_free_r_t_o_s_8h.html#a2661e2c5a4e4afe5bef2ebe9872e28b3">portCLEAR_INTERRUPT_MASK_FROM_ISR</a>( ulSavedInterruptMask );</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span> </div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>    <span class="keywordflow">if</span>( lYieldRequired != <a class="code hl_define" href="projdefs_8h.html#aa56260e937e7e203026707e5ba944273">pdFALSE</a> )</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>    {</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>        <span class="comment">/* Save the context of a task.</span></div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span><span class="comment">         * The upper context is automatically saved when entering a trap or interrupt.</span></div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span><span class="comment">         * Need to save the lower context as well and copy the PCXI CSA ID into</span></div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span><span class="comment">         * pxCurrentTCB-&gt;pxTopOfStack. Only Lower Context CSA IDs may be saved to the</span></div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span><span class="comment">         * TCB of a task.</span></div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span><span class="comment">         *</span></div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span><span class="comment">         * Call vTaskSwitchContext to select the next task, note that this changes the</span></div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span><span class="comment">         * value of pxCurrentTCB so that it needs to be reloaded.</span></div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span><span class="comment">         *</span></div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span><span class="comment">         * Call vPortSetMPURegisterSetOne to change the MPU mapping for the task</span></div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span><span class="comment">         * that has just been switched in.</span></div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span><span class="comment">         *</span></div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span><span class="comment">         * Load the context of the task.</span></div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span><span class="comment">         * Need to restore the lower context by loading the CSA from</span></div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span><span class="comment">         * pxCurrentTCB-&gt;pxTopOfStack into PCXI (effectively changing the call stack).</span></div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span><span class="comment">         * In the Interrupt handler post-amble, RSLCX will restore the lower context</span></div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span><span class="comment">         * of the task. RFE will restore the upper context of the task, jump to the</span></div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span><span class="comment">         * return address and restore the previous state of interrupts being</span></div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span><span class="comment">         * enabled/disabled. */</span></div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>        _disable();</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>        _dsync();</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>        xUpperCSA = __MFCR( $PCXI );</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>        pxUpperCSA = <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2portmacro_8h.html#a7bfbb11e7993c09f2c131e50b65edbff">portCSA_TO_ADDRESS</a>( xUpperCSA );</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>        *<a class="code hl_define" href="tasks_8c.html#aeceb1ce641f0a4c4a5a298b1f3cbae9e">pxCurrentTCB</a> = pxUpperCSA[ 0 ];</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>        <a class="code hl_function" href="_b_c_c_216_bit_d_o_s_2common_2portasm_8h.html#a9c86137bc3c1cbffc39fff22627cb885">vTaskSwitchContext</a>();</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>        pxUpperCSA[ 0 ] = *<a class="code hl_define" href="tasks_8c.html#aeceb1ce641f0a4c4a5a298b1f3cbae9e">pxCurrentTCB</a>;</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>        CPU_SRC0.bits.SETR = 0;</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>        _isync();</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>    }</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>}</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span><span class="comment">/*-----------------------------------------------------------*/</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span> </div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span><span class="comment">/*</span></div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span><span class="comment"> * When a task is deleted, it is yielded permanently until the IDLE task</span></div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span><span class="comment"> * has an opportunity to reclaim the memory that that task was using.</span></div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span><span class="comment"> * Typically, the memory used by a task is the TCB and Stack but in the</span></div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span><span class="comment"> * TriCore this includes the CSAs that were consumed as part of the Call</span></div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span><span class="comment"> * Stack. These CSAs can only be returned to the Globally Free Pool when</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span><span class="comment"> * they are not part of the current Call Stack, hence, delaying the</span></div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span><span class="comment"> * reclamation until the IDLE task is freeing the task&#39;s other resources.</span></div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span><span class="comment"> * This function uses the head of the linked list of CSAs (from when the</span></div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span><span class="comment"> * task yielded for the last time) and finds the tail (the very bottom of</span></div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span><span class="comment"> * the call stack) and inserts this list at the head of the Free list,</span></div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span><span class="comment"> * attaching the existing Free List to the tail of the reclaimed call stack.</span></div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span><span class="comment"> *</span></div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span><span class="comment"> * NOTE: the IDLE task needs processing time to complete this function</span></div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span><span class="comment"> * and in heavily loaded systems, the Free CSAs may be consumed faster</span></div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span><span class="comment"> * than they can be freed assuming that tasks are being spawned and</span></div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span><span class="comment"> * deleted frequently.</span></div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00385" data-start="{" data-end="}">
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno"><a class="line" href="_g_c_c_2_tri_core__1782_2port_8c.html#a439885284a5dd45017f84a4a80d03afc">  385</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="_g_c_c_2_tri_core__1782_2port_8c.html#a439885284a5dd45017f84a4a80d03afc">vPortReclaimCSA</a>( uint32_t * pxTCB )</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>{</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>    uint32_t pxHeadCSA, pxTailCSA, pxFreeCSA;</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>    uint32_t * pulNextCSA;</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span> </div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>    <span class="comment">/* A pointer to the first CSA in the list of CSAs consumed by the task is</span></div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span><span class="comment">     * stored in the first element of the tasks TCB structure (where the stack</span></div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span><span class="comment">     * pointer would be on a traditional stack based architecture). */</span></div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>    pxHeadCSA = ( *pxTCB ) &amp; <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2port_8c.html#a24b47f41a4ccf1c96020b4981fec5f98">portCSA_FCX_MASK</a>;</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span> </div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>    <span class="comment">/* Mask off everything in the CSA link field other than the address.  If</span></div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span><span class="comment">     * the address is NULL, then the CSA is not linking anywhere and there is</span></div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span><span class="comment">     * nothing to do. */</span></div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>    pxTailCSA = pxHeadCSA;</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span> </div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>    <span class="comment">/* Convert the link value to contain just a raw address and store this</span></div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span><span class="comment">     * in a local variable. */</span></div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>    pulNextCSA = <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2portmacro_8h.html#a7bfbb11e7993c09f2c131e50b65edbff">portCSA_TO_ADDRESS</a>( pxTailCSA );</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span> </div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>    <span class="comment">/* Iterate over the CSAs that were consumed as part of the task.  The</span></div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span><span class="comment">     * first field in the CSA is the pointer to then next CSA.  Mask off</span></div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span><span class="comment">     * everything in the pointer to the next CSA, other than the link address.</span></div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span><span class="comment">     * If this is NULL, then the CSA currently being pointed to is the last in</span></div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span><span class="comment">     * the chain. */</span></div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>    <span class="keywordflow">while</span>( 0UL != ( pulNextCSA[ 0 ] &amp; <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2port_8c.html#a24b47f41a4ccf1c96020b4981fec5f98">portCSA_FCX_MASK</a> ) )</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>    {</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>        <span class="comment">/* Clear all bits of the pointer to the next in the chain, other</span></div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span><span class="comment">         * than the address bits themselves. */</span></div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>        pulNextCSA[ 0 ] = pulNextCSA[ 0 ] &amp; <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2port_8c.html#a24b47f41a4ccf1c96020b4981fec5f98">portCSA_FCX_MASK</a>;</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span> </div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>        <span class="comment">/* Move the pointer to point to the next CSA in the list. */</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>        pxTailCSA = pulNextCSA[ 0 ];</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span> </div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>        <span class="comment">/* Update the local pointer to the CSA. */</span></div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>        pulNextCSA = <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2portmacro_8h.html#a7bfbb11e7993c09f2c131e50b65edbff">portCSA_TO_ADDRESS</a>( pxTailCSA );</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>    }</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span> </div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>    _disable();</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>    {</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>        <span class="comment">/* Look up the current free CSA head. */</span></div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>        _dsync();</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>        pxFreeCSA = __MFCR( $FCX );</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span> </div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>        <span class="comment">/* Join the current Free onto the Tail of what is being reclaimed. */</span></div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>        <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2portmacro_8h.html#a7bfbb11e7993c09f2c131e50b65edbff">portCSA_TO_ADDRESS</a>( pxTailCSA )[ 0 ] = pxFreeCSA;</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span> </div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>        <span class="comment">/* Move the head of the reclaimed into the Free. */</span></div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>        _dsync();</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>        _mtcr( $FCX, pxHeadCSA );</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>        _isync();</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>    }</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>    _enable();</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>}</div>
</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span><span class="comment">/*-----------------------------------------------------------*/</span></div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span> </div>
<div class="foldopen" id="foldopen00440" data-start="{" data-end="}">
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno"><a class="line" href="_g_c_c_2_tri_core__1782_2port_8c.html#af76f3c0b44c5b5c06fc046a4ee1a6423">  440</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="_a_r_mv8_m_2non__secure_2port_8c.html#af76f3c0b44c5b5c06fc046a4ee1a6423">vPortEndScheduler</a>( <span class="keywordtype">void</span> )</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>{</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>    <span class="comment">/* Nothing to do. Unlikely to want to end. */</span></div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>}</div>
</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span><span class="comment">/*-----------------------------------------------------------*/</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span> </div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span><span class="keyword">static</span> <span class="keywordtype">void</span> prvTrapYield( <span class="keywordtype">int</span> iTrapIdentification )</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>{</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>    uint32_t * pxUpperCSA = <a class="code hl_define" href="_third_party_2_g_c_c_2_a_r_c___e_m___h_s_2portmacro_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>    uint32_t xUpperCSA = 0UL;</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>    <span class="keyword">extern</span> <span class="keyword">volatile</span> uint32_t * <a class="code hl_define" href="tasks_8c.html#aeceb1ce641f0a4c4a5a298b1f3cbae9e">pxCurrentTCB</a>;</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span> </div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>    <span class="keywordflow">switch</span>( iTrapIdentification )</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>    {</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2portmacro_8h.html#a29bb80ae7b67ad3a2d45e91dacb790bf">portSYSCALL_TASK_YIELD</a>:</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span> </div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>            <span class="comment">/* Save the context of a task.</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span><span class="comment">             * The upper context is automatically saved when entering a trap or interrupt.</span></div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span><span class="comment">             * Need to save the lower context as well and copy the PCXI CSA ID into</span></div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span><span class="comment">             * pxCurrentTCB-&gt;pxTopOfStack. Only Lower Context CSA IDs may be saved to the</span></div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span><span class="comment">             * TCB of a task.</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span><span class="comment">             *</span></div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span><span class="comment">             * Call vTaskSwitchContext to select the next task, note that this changes the</span></div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span><span class="comment">             * value of pxCurrentTCB so that it needs to be reloaded.</span></div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span><span class="comment">             *</span></div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span><span class="comment">             * Call vPortSetMPURegisterSetOne to change the MPU mapping for the task</span></div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span><span class="comment">             * that has just been switched in.</span></div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span><span class="comment">             *</span></div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span><span class="comment">             * Load the context of the task.</span></div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span><span class="comment">             * Need to restore the lower context by loading the CSA from</span></div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span><span class="comment">             * pxCurrentTCB-&gt;pxTopOfStack into PCXI (effectively changing the call stack).</span></div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span><span class="comment">             * In the Interrupt handler post-amble, RSLCX will restore the lower context</span></div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span><span class="comment">             * of the task. RFE will restore the upper context of the task, jump to the</span></div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span><span class="comment">             * return address and restore the previous state of interrupts being</span></div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span><span class="comment">             * enabled/disabled. */</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>            _disable();</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>            _dsync();</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>            xUpperCSA = __MFCR( $PCXI );</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>            pxUpperCSA = <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2portmacro_8h.html#a7bfbb11e7993c09f2c131e50b65edbff">portCSA_TO_ADDRESS</a>( xUpperCSA );</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>            *<a class="code hl_define" href="tasks_8c.html#aeceb1ce641f0a4c4a5a298b1f3cbae9e">pxCurrentTCB</a> = pxUpperCSA[ 0 ];</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>            <a class="code hl_function" href="_b_c_c_216_bit_d_o_s_2common_2portasm_8h.html#a9c86137bc3c1cbffc39fff22627cb885">vTaskSwitchContext</a>();</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>            pxUpperCSA[ 0 ] = *<a class="code hl_define" href="tasks_8c.html#aeceb1ce641f0a4c4a5a298b1f3cbae9e">pxCurrentTCB</a>;</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>            CPU_SRC0.bits.SETR = 0;</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>            _isync();</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span> </div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>            <span class="comment">/* Unimplemented trap called. */</span></div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>            <a class="code hl_define" href="_free_r_t_o_s-_kernel_2examples_2template__configuration_2_free_r_t_o_s_config_8h.html#a228c70cd48927d6ab730ed1a6dfbe35f">configASSERT</a>( ( ( <span class="keyword">volatile</span> <span class="keywordtype">void</span> * ) <a class="code hl_define" href="_third_party_2_g_c_c_2_a_r_c___e_m___h_s_2portmacro_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ) );</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>    }</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>}</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span><span class="comment">/*-----------------------------------------------------------*/</span></div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span> </div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span><span class="keyword">static</span> <span class="keywordtype">void</span> prvInterruptYield( <span class="keywordtype">int</span> iId )</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>{</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>    uint32_t * pxUpperCSA = <a class="code hl_define" href="_third_party_2_g_c_c_2_a_r_c___e_m___h_s_2portmacro_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>    uint32_t xUpperCSA = 0UL;</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>    <span class="keyword">extern</span> <span class="keyword">volatile</span> uint32_t * <a class="code hl_define" href="tasks_8c.html#aeceb1ce641f0a4c4a5a298b1f3cbae9e">pxCurrentTCB</a>;</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span> </div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>    <span class="comment">/* Just to remove compiler warnings. */</span></div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>    ( void ) iId;</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span> </div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>    <span class="comment">/* Save the context of a task.</span></div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span><span class="comment">     * The upper context is automatically saved when entering a trap or interrupt.</span></div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span><span class="comment">     * Need to save the lower context as well and copy the PCXI CSA ID into</span></div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span><span class="comment">     * pxCurrentTCB-&gt;pxTopOfStack. Only Lower Context CSA IDs may be saved to the</span></div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span><span class="comment">     * TCB of a task.</span></div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span><span class="comment">     *</span></div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span><span class="comment">     * Call vTaskSwitchContext to select the next task, note that this changes the</span></div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span><span class="comment">     * value of pxCurrentTCB so that it needs to be reloaded.</span></div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span><span class="comment">     *</span></div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span><span class="comment">     * Call vPortSetMPURegisterSetOne to change the MPU mapping for the task</span></div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span><span class="comment">     * that has just been switched in.</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span><span class="comment">     *</span></div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span><span class="comment">     * Load the context of the task.</span></div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span><span class="comment">     * Need to restore the lower context by loading the CSA from</span></div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span><span class="comment">     * pxCurrentTCB-&gt;pxTopOfStack into PCXI (effectively changing the call stack).</span></div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span><span class="comment">     * In the Interrupt handler post-amble, RSLCX will restore the lower context</span></div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span><span class="comment">     * of the task. RFE will restore the upper context of the task, jump to the</span></div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span><span class="comment">     * return address and restore the previous state of interrupts being</span></div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span><span class="comment">     * enabled/disabled. */</span></div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>    _disable();</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>    _dsync();</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>    xUpperCSA = __MFCR( $PCXI );</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>    pxUpperCSA = <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2portmacro_8h.html#a7bfbb11e7993c09f2c131e50b65edbff">portCSA_TO_ADDRESS</a>( xUpperCSA );</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>    *<a class="code hl_define" href="tasks_8c.html#aeceb1ce641f0a4c4a5a298b1f3cbae9e">pxCurrentTCB</a> = pxUpperCSA[ 0 ];</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>    <a class="code hl_function" href="_b_c_c_216_bit_d_o_s_2common_2portasm_8h.html#a9c86137bc3c1cbffc39fff22627cb885">vTaskSwitchContext</a>();</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>    pxUpperCSA[ 0 ] = *<a class="code hl_define" href="tasks_8c.html#aeceb1ce641f0a4c4a5a298b1f3cbae9e">pxCurrentTCB</a>;</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>    CPU_SRC0.bits.SETR = 0;</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>    _isync();</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>}</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span><span class="comment">/*-----------------------------------------------------------*/</span></div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span> </div>
<div class="foldopen" id="foldopen00534" data-start="{" data-end="}">
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno"><a class="line" href="_code_warrior_2_cold_fire___v1_2portmacro_8h.html#ad3b846f809a7cff169a8c3cb621ec1ee">  534</a></span>uint32_t <a class="code hl_function" href="_g_c_c_2_tri_core__1782_2port_8c.html#ad2d8a18289cda8ec91acf0a4dce63e30">uxPortSetInterruptMaskFromISR</a>( <span class="keywordtype">void</span> )</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>{</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>    uint32_t uxReturn = 0UL;</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span> </div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>    _disable();</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>    uxReturn = __MFCR( $ICR );</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>    _mtcr( $ICR, ( ( uxReturn &amp; ~<a class="code hl_define" href="_g_c_c_2_tri_core__1782_2portmacro_8h.html#a0eec68f987bc22eeca0775242c24af6a">portCCPN_MASK</a> ) | <a class="code hl_define" href="_free_r_t_o_s-_kernel_2examples_2coverity_2_free_r_t_o_s_config_8h.html#a54bfc31c410ee452577a25a4552c3704">configMAX_SYSCALL_INTERRUPT_PRIORITY</a> ) );</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>    _isync();</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>    _enable();</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span> </div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>    <span class="comment">/* Return just the interrupt mask bits. */</span></div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>    <span class="keywordflow">return</span>( uxReturn &amp; <a class="code hl_define" href="_g_c_c_2_tri_core__1782_2portmacro_8h.html#a0eec68f987bc22eeca0775242c24af6a">portCCPN_MASK</a> );</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>}</div>
</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span><span class="comment">/*-----------------------------------------------------------*/</span></div>
<div class="ttc" id="a_a_r_mv8_m_2non__secure_2port_8c_html_aaa2085423d917cf1707f4770de3354e2"><div class="ttname"><a href="_a_r_mv8_m_2non__secure_2port_8c.html#aaa2085423d917cf1707f4770de3354e2">pxPortInitialiseStack</a></div><div class="ttdeci">StackType_t * pxPortInitialiseStack(StackType_t *pxTopOfStack, StackType_t *pxEndOfStack, TaskFunction_t pxCode, void *pvParameters)</div><div class="ttdef"><b>Definition</b> <a href="_a_r_mv8_m_2non__secure_2port_8c_source.html#l01544">port.c:1544</a></div></div>
<div class="ttc" id="a_a_r_mv8_m_2non__secure_2port_8c_html_ade5a8c6666e7413a0355cc252029c5c6"><div class="ttname"><a href="_a_r_mv8_m_2non__secure_2port_8c.html#ade5a8c6666e7413a0355cc252029c5c6">xPortStartScheduler</a></div><div class="ttdeci">BaseType_t xPortStartScheduler(void)</div><div class="ttdef"><b>Definition</b> <a href="_a_r_mv8_m_2non__secure_2port_8c_source.html#l01627">port.c:1627</a></div></div>
<div class="ttc" id="a_a_r_mv8_m_2non__secure_2port_8c_html_af76f3c0b44c5b5c06fc046a4ee1a6423"><div class="ttname"><a href="_a_r_mv8_m_2non__secure_2port_8c.html#af76f3c0b44c5b5c06fc046a4ee1a6423">vPortEndScheduler</a></div><div class="ttdeci">void vPortEndScheduler(void)</div><div class="ttdoc">End the FreeRTOS scheduler.</div><div class="ttdef"><b>Definition</b> <a href="_a_r_mv8_m_2non__secure_2port_8c_source.html#l01780">port.c:1780</a></div></div>
<div class="ttc" id="a_a_r_mv8_m_2non__secure_2portmacrocommon_8h_html_a529358e6147881dd881c890ade21c9bd"><div class="ttname"><a href="_a_r_mv8_m_2non__secure_2portmacrocommon_8h.html#a529358e6147881dd881c890ade21c9bd">portEXIT_CRITICAL</a></div><div class="ttdeci">#define portEXIT_CRITICAL()</div><div class="ttdef"><b>Definition</b> <a href="_a_r_mv8_m_2non__secure_2portmacrocommon_8h_source.html#l00368">portmacrocommon.h:368</a></div></div>
<div class="ttc" id="a_a_r_mv8_m_2non__secure_2portmacrocommon_8h_html_a84e9a8ba132feed0b2401c1f4e2ac63c"><div class="ttname"><a href="_a_r_mv8_m_2non__secure_2portmacrocommon_8h.html#a84e9a8ba132feed0b2401c1f4e2ac63c">StackType_t</a></div><div class="ttdeci">portSTACK_TYPE StackType_t</div><div class="ttdef"><b>Definition</b> <a href="_a_r_mv8_m_2non__secure_2portmacrocommon_8h_source.html#l00073">portmacrocommon.h:73</a></div></div>
<div class="ttc" id="a_a_r_mv8_m_2non__secure_2portmacrocommon_8h_html_a8a09321ad004019f3c8d0f2e4d7224c7"><div class="ttname"><a href="_a_r_mv8_m_2non__secure_2portmacrocommon_8h.html#a8a09321ad004019f3c8d0f2e4d7224c7">portENTER_CRITICAL</a></div><div class="ttdeci">#define portENTER_CRITICAL()</div><div class="ttdef"><b>Definition</b> <a href="_a_r_mv8_m_2non__secure_2portmacrocommon_8h_source.html#l00367">portmacrocommon.h:367</a></div></div>
<div class="ttc" id="a_b_c_c_216_bit_d_o_s_2common_2portasm_8h_html_a9c86137bc3c1cbffc39fff22627cb885"><div class="ttname"><a href="_b_c_c_216_bit_d_o_s_2common_2portasm_8h.html#a9c86137bc3c1cbffc39fff22627cb885">vTaskSwitchContext</a></div><div class="ttdeci">void vTaskSwitchContext(void)</div></div>
<div class="ttc" id="a_free_r_t_o_s-_kernel_2examples_2coverity_2_free_r_t_o_s_config_8h_html_a2f0258dd1e3b877e5bc013be54c2db6a"><div class="ttname"><a href="_free_r_t_o_s-_kernel_2examples_2coverity_2_free_r_t_o_s_config_8h.html#a2f0258dd1e3b877e5bc013be54c2db6a">configTICK_RATE_HZ</a></div><div class="ttdeci">#define configTICK_RATE_HZ</div><div class="ttdef"><b>Definition</b> <a href="_free_r_t_o_s-_kernel_2examples_2coverity_2_free_r_t_o_s_config_8h_source.html#l00042">FreeRTOSConfig.h:42</a></div></div>
<div class="ttc" id="a_free_r_t_o_s-_kernel_2examples_2coverity_2_free_r_t_o_s_config_8h_html_a54bfc31c410ee452577a25a4552c3704"><div class="ttname"><a href="_free_r_t_o_s-_kernel_2examples_2coverity_2_free_r_t_o_s_config_8h.html#a54bfc31c410ee452577a25a4552c3704">configMAX_SYSCALL_INTERRUPT_PRIORITY</a></div><div class="ttdeci">#define configMAX_SYSCALL_INTERRUPT_PRIORITY</div><div class="ttdef"><b>Definition</b> <a href="_free_r_t_o_s-_kernel_2examples_2coverity_2_free_r_t_o_s_config_8h_source.html#l00085">FreeRTOSConfig.h:85</a></div></div>
<div class="ttc" id="a_free_r_t_o_s-_kernel_2examples_2coverity_2_free_r_t_o_s_config_8h_html_ac42cff506ad61d4174fa23e952e3225e"><div class="ttname"><a href="_free_r_t_o_s-_kernel_2examples_2coverity_2_free_r_t_o_s_config_8h.html#ac42cff506ad61d4174fa23e952e3225e">configKERNEL_INTERRUPT_PRIORITY</a></div><div class="ttdeci">#define configKERNEL_INTERRUPT_PRIORITY</div><div class="ttdef"><b>Definition</b> <a href="_free_r_t_o_s-_kernel_2examples_2coverity_2_free_r_t_o_s_config_8h_source.html#l00084">FreeRTOSConfig.h:84</a></div></div>
<div class="ttc" id="a_free_r_t_o_s-_kernel_2examples_2template__configuration_2_free_r_t_o_s_config_8h_html_a228c70cd48927d6ab730ed1a6dfbe35f"><div class="ttname"><a href="_free_r_t_o_s-_kernel_2examples_2template__configuration_2_free_r_t_o_s_config_8h.html#a228c70cd48927d6ab730ed1a6dfbe35f">configASSERT</a></div><div class="ttdeci">#define configASSERT(x)</div><div class="ttdef"><b>Definition</b> <a href="_free_r_t_o_s-_kernel_2examples_2template__configuration_2_free_r_t_o_s_config_8h_source.html#l00418">FreeRTOSConfig.h:418</a></div></div>
<div class="ttc" id="a_free_r_t_o_s_8h_html"><div class="ttname"><a href="_free_r_t_o_s_8h.html">FreeRTOS.h</a></div></div>
<div class="ttc" id="a_free_r_t_o_s_8h_html_a2661e2c5a4e4afe5bef2ebe9872e28b3"><div class="ttname"><a href="_free_r_t_o_s_8h.html#a2661e2c5a4e4afe5bef2ebe9872e28b3">portCLEAR_INTERRUPT_MASK_FROM_ISR</a></div><div class="ttdeci">#define portCLEAR_INTERRUPT_MASK_FROM_ISR(uxSavedStatusValue)</div><div class="ttdef"><b>Definition</b> <a href="_free_r_t_o_s_8h_source.html#l00560">FreeRTOS.h:560</a></div></div>
<div class="ttc" id="a_free_r_t_o_s_8h_html_a31b4260dbc1823ba80b578f86eb15a98"><div class="ttname"><a href="_free_r_t_o_s_8h.html#a31b4260dbc1823ba80b578f86eb15a98">portSET_INTERRUPT_MASK_FROM_ISR</a></div><div class="ttdeci">#define portSET_INTERRUPT_MASK_FROM_ISR()</div><div class="ttdef"><b>Definition</b> <a href="_free_r_t_o_s_8h_source.html#l00548">FreeRTOS.h:548</a></div></div>
<div class="ttc" id="a_g_c_c_2_a_r_m___a_a_r_c_h64_2port_8c_html_ab35b2424ac8c0625cfdbbcf916c5e1c3"><div class="ttname"><a href="_g_c_c_2_a_r_m___a_a_r_c_h64_2port_8c.html#ab35b2424ac8c0625cfdbbcf916c5e1c3">__attribute__</a></div><div class="ttdeci">__attribute__((used)) const</div><div class="ttdef"><b>Definition</b> <a href="_g_c_c_2_a_r_m___a_a_r_c_h64_2port_8c_source.html#l00169">port.c:169</a></div></div>
<div class="ttc" id="a_g_c_c_2_tri_core__1782_2port_8c_html_a04fc64e05f3949f4ff4b5c276c036407"><div class="ttname"><a href="_g_c_c_2_tri_core__1782_2port_8c.html#a04fc64e05f3949f4ff4b5c276c036407">portINITIAL_PCXI_UPPER_CONTEXT_WORD</a></div><div class="ttdeci">#define portINITIAL_PCXI_UPPER_CONTEXT_WORD</div><div class="ttdef"><b>Definition</b> <a href="#l00056">port.c:56</a></div></div>
<div class="ttc" id="a_g_c_c_2_tri_core__1782_2port_8c_html_a1191455c4b11064d65717fc18324faac"><div class="ttname"><a href="_g_c_c_2_tri_core__1782_2port_8c.html#a1191455c4b11064d65717fc18324faac">portENABLE_CPU_INTERRUPT</a></div><div class="ttdeci">#define portENABLE_CPU_INTERRUPT</div><div class="ttdef"><b>Definition</b> <a href="#l00070">port.c:70</a></div></div>
<div class="ttc" id="a_g_c_c_2_tri_core__1782_2port_8c_html_a24b47f41a4ccf1c96020b4981fec5f98"><div class="ttname"><a href="_g_c_c_2_tri_core__1782_2port_8c.html#a24b47f41a4ccf1c96020b4981fec5f98">portCSA_FCX_MASK</a></div><div class="ttdeci">#define portCSA_FCX_MASK</div><div class="ttdef"><b>Definition</b> <a href="#l00060">port.c:60</a></div></div>
<div class="ttc" id="a_g_c_c_2_tri_core__1782_2port_8c_html_a439885284a5dd45017f84a4a80d03afc"><div class="ttname"><a href="_g_c_c_2_tri_core__1782_2port_8c.html#a439885284a5dd45017f84a4a80d03afc">vPortReclaimCSA</a></div><div class="ttdeci">void vPortReclaimCSA(uint32_t *pxTCB)</div><div class="ttdef"><b>Definition</b> <a href="#l00385">port.c:385</a></div></div>
<div class="ttc" id="a_g_c_c_2_tri_core__1782_2port_8c_html_a53c7e0018d578cc75a6de242b255efe7"><div class="ttname"><a href="_g_c_c_2_tri_core__1782_2port_8c.html#a53c7e0018d578cc75a6de242b255efe7">portSYSTEM_PROGRAM_STATUS_WORD</a></div><div class="ttdeci">#define portSYSTEM_PROGRAM_STATUS_WORD</div><div class="ttdef"><b>Definition</b> <a href="#l00053">port.c:53</a></div></div>
<div class="ttc" id="a_g_c_c_2_tri_core__1782_2port_8c_html_a8b8c4b80063cf1c2f6da57b93b66d595"><div class="ttname"><a href="_g_c_c_2_tri_core__1782_2port_8c.html#a8b8c4b80063cf1c2f6da57b93b66d595">portRESTORE_PSW_MASK</a></div><div class="ttdeci">#define portRESTORE_PSW_MASK</div><div class="ttdef"><b>Definition</b> <a href="#l00063">port.c:63</a></div></div>
<div class="ttc" id="a_g_c_c_2_tri_core__1782_2port_8c_html_ad00855b9a1ed5b492cea473aa43574af"><div class="ttname"><a href="_g_c_c_2_tri_core__1782_2port_8c.html#ad00855b9a1ed5b492cea473aa43574af">portINITIAL_SYSCON</a></div><div class="ttdeci">#define portINITIAL_SYSCON</div><div class="ttdef"><b>Definition</b> <a href="#l00057">port.c:57</a></div></div>
<div class="ttc" id="a_g_c_c_2_tri_core__1782_2port_8c_html_ad2d8a18289cda8ec91acf0a4dce63e30"><div class="ttname"><a href="_g_c_c_2_tri_core__1782_2port_8c.html#ad2d8a18289cda8ec91acf0a4dce63e30">uxPortSetInterruptMaskFromISR</a></div><div class="ttdeci">uint32_t uxPortSetInterruptMaskFromISR(void)</div><div class="ttdef"><b>Definition</b> <a href="#l00534">port.c:534</a></div></div>
<div class="ttc" id="a_g_c_c_2_tri_core__1782_2port_8c_html_ad3bc25f78b2c1da77824c18234353c71"><div class="ttname"><a href="_g_c_c_2_tri_core__1782_2port_8c.html#ad3bc25f78b2c1da77824c18234353c71">portNUM_WORDS_IN_CSA</a></div><div class="ttdeci">#define portNUM_WORDS_IN_CSA</div><div class="ttdef"><b>Definition</b> <a href="#l00067">port.c:67</a></div></div>
<div class="ttc" id="a_g_c_c_2_tri_core__1782_2port_8c_html_af46f8ef7814652af16a16ef746a6fe56"><div class="ttname"><a href="_g_c_c_2_tri_core__1782_2port_8c.html#af46f8ef7814652af16a16ef746a6fe56">portSYSCALL_TRAP</a></div><div class="ttdeci">#define portSYSCALL_TRAP</div><div class="ttdef"><b>Definition</b> <a href="#l00064">port.c:64</a></div></div>
<div class="ttc" id="a_g_c_c_2_tri_core__1782_2portmacro_8h_html_a0eec68f987bc22eeca0775242c24af6a"><div class="ttname"><a href="_g_c_c_2_tri_core__1782_2portmacro_8h.html#a0eec68f987bc22eeca0775242c24af6a">portCCPN_MASK</a></div><div class="ttdeci">#define portCCPN_MASK</div><div class="ttdef"><b>Definition</b> <a href="_g_c_c_2_tri_core__1782_2portmacro_8h_source.html#l00099">portmacro.h:99</a></div></div>
<div class="ttc" id="a_g_c_c_2_tri_core__1782_2portmacro_8h_html_a29bb80ae7b67ad3a2d45e91dacb790bf"><div class="ttname"><a href="_g_c_c_2_tri_core__1782_2portmacro_8h.html#a29bb80ae7b67ad3a2d45e91dacb790bf">portSYSCALL_TASK_YIELD</a></div><div class="ttdeci">#define portSYSCALL_TASK_YIELD</div><div class="ttdef"><b>Definition</b> <a href="_g_c_c_2_tri_core__1782_2portmacro_8h_source.html#l00114">portmacro.h:114</a></div></div>
<div class="ttc" id="a_g_c_c_2_tri_core__1782_2portmacro_8h_html_a625b0cc597364c07a6fa0f13f7c83374"><div class="ttname"><a href="_g_c_c_2_tri_core__1782_2portmacro_8h.html#a625b0cc597364c07a6fa0f13f7c83374">portADDRESS_TO_CSA</a></div><div class="ttdeci">#define portADDRESS_TO_CSA(pAddress)</div><div class="ttdef"><b>Definition</b> <a href="_g_c_c_2_tri_core__1782_2portmacro_8h_source.html#l00109">portmacro.h:109</a></div></div>
<div class="ttc" id="a_g_c_c_2_tri_core__1782_2portmacro_8h_html_a7bfbb11e7993c09f2c131e50b65edbff"><div class="ttname"><a href="_g_c_c_2_tri_core__1782_2portmacro_8h.html#a7bfbb11e7993c09f2c131e50b65edbff">portCSA_TO_ADDRESS</a></div><div class="ttdeci">#define portCSA_TO_ADDRESS(pCSA)</div><div class="ttdef"><b>Definition</b> <a href="_g_c_c_2_tri_core__1782_2portmacro_8h_source.html#l00108">portmacro.h:108</a></div></div>
<div class="ttc" id="a_rowley_2_m_s_p430_f449_2port_8c_html_a397ed34de04a678dc71217c713763423"><div class="ttname"><a href="_rowley_2_m_s_p430_f449_2port_8c.html#a397ed34de04a678dc71217c713763423">prvSetupTimerInterrupt</a></div><div class="ttdeci">void prvSetupTimerInterrupt(void)</div><div class="ttdef"><b>Definition</b> <a href="_rowley_2_m_s_p430_f449_2port_8c_source.html#l00147">port.c:147</a></div></div>
<div class="ttc" id="a_third_party_2_g_c_c_2_a_r_c___e_m___h_s_2portmacro_8h_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="_third_party_2_g_c_c_2_a_r_c___e_m___h_s_2portmacro_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition</b> <a href="_third_party_2_g_c_c_2_a_r_c___e_m___h_s_2portmacro_8h_source.html#l00070">portmacro.h:70</a></div></div>
<div class="ttc" id="alist_8h_html"><div class="ttname"><a href="list_8h.html">list.h</a></div></div>
<div class="ttc" id="aporttrap_8c_html_abb81dc2f729d6c6fe39b23aa9f61e1a5"><div class="ttname"><a href="porttrap_8c.html#abb81dc2f729d6c6fe39b23aa9f61e1a5">vTrapInstallHandlers</a></div><div class="ttdeci">void vTrapInstallHandlers(void)</div><div class="ttdef"><b>Definition</b> <a href="porttrap_8c_source.html#l00116">porttrap.c:116</a></div></div>
<div class="ttc" id="aprojdefs_8h_html_a0ab243e55144f5278d263729530dac14"><div class="ttname"><a href="projdefs_8h.html#a0ab243e55144f5278d263729530dac14">TaskFunction_t</a></div><div class="ttdeci">void(* TaskFunction_t)(void *arg)</div><div class="ttdef"><b>Definition</b> <a href="projdefs_8h_source.html#l00036">projdefs.h:36</a></div></div>
<div class="ttc" id="aprojdefs_8h_html_aa56260e937e7e203026707e5ba944273"><div class="ttname"><a href="projdefs_8h.html#aa56260e937e7e203026707e5ba944273">pdFALSE</a></div><div class="ttdeci">#define pdFALSE</div><div class="ttdef"><b>Definition</b> <a href="projdefs_8h_source.html#l00052">projdefs.h:52</a></div></div>
<div class="ttc" id="atask_8h_html"><div class="ttname"><a href="task_8h.html">task.h</a></div></div>
<div class="ttc" id="atask_8h_html_a978e25460ac35706f9ad30b46d9403d8"><div class="ttname"><a href="task_8h.html#a978e25460ac35706f9ad30b46d9403d8">xTaskIncrementTick</a></div><div class="ttdeci">BaseType_t xTaskIncrementTick(void) PRIVILEGED_FUNCTION</div><div class="ttdef"><b>Definition</b> <a href="tasks_8c_source.html#l04674">tasks.c:4674</a></div></div>
<div class="ttc" id="atasks_8c_html_aeceb1ce641f0a4c4a5a298b1f3cbae9e"><div class="ttname"><a href="tasks_8c.html#aeceb1ce641f0a4c4a5a298b1f3cbae9e">pxCurrentTCB</a></div><div class="ttdeci">#define pxCurrentTCB</div><div class="ttdef"><b>Definition</b> <a href="tasks_8c_source.html#l00452">tasks.c:452</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_4a0bb1d3edd3cd3470ff45ba93d7cb46.html">pico_freertos</a></li><li class="navelem"><a href="dir_5270f1867b04849f6c4cddceb76c0650.html">FreeRTOS-Kernel</a></li><li class="navelem"><a href="dir_2901950e674b11bd625d37cd8c5cecca.html">portable</a></li><li class="navelem"><a href="dir_d47f747b1f9f69e8b995df24b56b1471.html">GCC</a></li><li class="navelem"><a href="dir_12787c6ea5e0763d49ec7dee47cc0783.html">TriCore_1782</a></li><li class="navelem"><a href="_g_c_c_2_tri_core__1782_2port_8c.html">port.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
